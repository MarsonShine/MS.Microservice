# 无服务架构（Serverless Architectures）

无服务器架构是一种应用程序设计，它整合了第三方的 “后端即服务（backend as a service）” (BaaS)服务，以及/或包含在“ 功能即服务（functional as a service）” (FaaS) 平台上托管的临时容器中运行的自定义代码。通过使用这些思想以及单页应用程序等相关思想，这样的体系结构消除了对传统的始终在线服务器组件的大量需求。无服务器架构可能受益于显著降低的操作开销、复杂度和工程交付时间，而代价是增加对供应商依赖和相对不成熟的支持服务的依赖。

**无服务计算（Serverless Computing）**，或者更简单的 Serverless，在软件架构世界中是一个非常火热的话题。云供应商三巨头 —— Amazon、Google 以及 Microsoft 都很在 Serverless 上投资了大量资源，我们看到的许多致力于此的大量书籍以及开源项目，会议以及软件供应商。但是什么是 Serverless？为什么考虑 Serverless 是值得的？这篇文章就是为了解决这些问题的。

让我们从什么是无服务架构开始，并列出其中的优点和缺点。

# 什么是 Serverless？

就像软件领域的许多趋势一样，没有人清楚地知道什么是无服务器。首先，它包含两个不同但重叠的领域：

1. Serverless 最初用于描述显著或完全合并第三方云托管应用程序和服务的应用程序，以管理服务器端逻辑和状态。这些典型的 “富客户端（rich client）” 应用程序 —— 想想单页面应用程序或移动应用程序 —— 使用云访问数据库（如 Parse、Firebase）的庞大生态系统，身份验证服务（如 Auth0、AWS Cognito），等等。这些类型的服务之前都被描述为 “后端即服务”，我在后面的内容将此简述为 “BaaS”。
2. Serverless 也可以是指服务器端逻辑仍然由应用程序开发人员编写的应用程序，但是，与传统架构不同的是，它运行在无状态计算的容器中，它负责事件触发的、短暂的(可能只持续一次调用)、完全由第三方管理的。称之为 “函数即服务（FaaS）”。（注意：[原始资源](https://twitter.com/marak/status/736357543598002176)将它命名的，但是现在无法访问了）[AWS Lambda](https://aws.amazon.com/lambda/) 是其中最受欢迎的 FaaS 平台实现，但是也有很多其它的实现。

在这篇文章里，我们主要集中讨论 FaaS。这不仅是因为 Serverless 领域的更新和大量的炒作，而且它与我们通常认为的技术架构有显著的不同。

BaaS 和 Faas 在它们的操作属性中有一些是相关的（如无资源管理）并且经常一起使用。最大的云供应商全部都有 “无服务组合（Serverless portfolios）”，包含 BaaS 和 Faas 的一些产品—— 例如，[Amazon Serverless](https://aws.amazon.com/serverless/) 产品页。Google 的 BaaS 数据库 Firebase 数据库就已经通过 [Google 云函数 Firebase](https://firebase.google.com/docs/functions/) 显式支持了 FaaS。

小公司在这两个领域也有类似的联系。[Auth0](https://auth0.com/) 从一个实现了多用户管理的 BaaS 产品开始，随后创建了配套的 FaaS 服务 [Webtask](https://webtask.io/)。该公司通过扩展将这一想法更进一步，使其他 SaaS 和 BaaS 公司能够轻松地向现有产品添加 FaaS 功能，从而创建统一的无服务器产品。

# 一系列的案例

## UI 驱动程序

让我们回头看具有服务器端逻辑的传统三层面向客户端的系统。一个典型的例子就是电商 app。

传统架构图看起来就像下面展示：

![](./asserts/ps.svg)

使用这种体系结构，客户端可能相对不智能，系统中的许多逻辑 —— 身份验证、页面导航、搜索和事务 —— 都是由服务器应用程序实现的。

如果使用 Serverless 架构的话，那么就会像下图所示：

![](./asserts/sps.svg)

这是一个非常简化的视图，但即使在这里我们也看到了一些显著的变化：

1. 我们在应用程序中删除了身份验证以及用第三方 BaaS 服务替换（如 Auth0）

2. 使用其它的 BaaS 的案例，我们允许客户端直接访问数据库的一个子集（用于产品列表），该数据库本身完全由第三方托管（例如谷歌 Firebase）。对于以这种方式访问数据库的客户机，我们可能有不同的安全配置文件，而对于访问数据库的服务器资源，我们可能有不同的安全配置文件。

3. 前面两点暗示了非常重要的第三点：一些在宠物商店服务（Pet Store Server）中的逻辑现在在客户端中，例如，跟踪用户会话，理解应用程序的 UX 结构，从数据库读取数据并将其转换成可用的视图，等等。客户端正在朝着成为单页应用程序的方向发展。

4. 我们可能希望在服务器中保留一些与 UX 相关的功能，例如，如果它是计算密集型的或需要访问大量的数据。在我们的宠物店例子中就是 “搜索” 功能。与原始体系结构中始终运行的服务器不同，我们可以实现一个 FaaS 函数，该函数通过 API 网关（稍后介绍）响应 HTTP 请求。客户端和服务器的 “搜索” 功能都从同一个数据库中读取产品数据。

   如果我们选择使用 AWS Lambda 作为我们的 FaaS 平台，我们可以将从原来的宠物商店服务器的搜索代码移植到新的宠物商店上，而不需要完全重写，因为 Lambda  支持 Java 和 javascript —— 我们最初使用的实现语言。

5. 最后，我们可以将 “Purchase” 功能替换为另一个独立的 FaaS 功能，出于安全考虑，选择将其保留在服务器端，而不是在客户端中重新实现它。它的前端也是一个 API 网关。**在使用 FaaS 时，将不同的逻辑需求分解为单独部署的组件是一种非常常见的方法。**

回过头来看，这个例子展示了关于无服务架构的另一个非常重要的观点。在原始版本中，所有流、控制和安全性都由中央服务器应用程序管理（中心化管理）。在无服务版本中，没有这些问题的中心仲裁者。**是去中心化的**。相反，我们看到编排比编排（**choreography over orchestration** ）更受欢迎，每个组件都扮演更具有体系结构意识的角色 —— 这一想法在微服务方法中也很常见。

使用这种方式有很多好处。Sam Newman 在他的[构建微服务](https://samnewman.io/books/building_microservices/)的笔记中记载道，以这种方式构建系统会 “更加灵活，更加适应变化”，无论是作为整体还是通过组件的独立更新；有更好的明确的分工；还有一些令人着迷的成本效益，Gojko Adzic 在这次精彩的[演讲](https://gojko.net/2017/10/05/serverless-design-gotocph.html)中讨论了这一点。

## 消息驱动程序、

另一个例子是后端数据处理服务。

原文连接：https://martinfowler.com/articles/serverless.html